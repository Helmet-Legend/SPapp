<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="version" content="1.10">
    <meta name="author" content="RESCUEAPP - LP ACADEMY">
    <meta name="theme-color" content="#c41e3a">
    <title>DECIOPS v1.10</title>
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body class="theme-day">
    <script>
    async function genererManoeuvre() {
        const btn = document.getElementById('btn-generer');
        const resultatDiv = document.getElementById('resultat-ia');
        const contenuDiv = document.getElementById('scenario-contenu');

        // Collecte des donn√©es
        const types = getCheckedValues('type');
        if (types.length === 0) {
            alert('‚ö†Ô∏è Veuillez s√©lectionner au moins un type de man≈ìuvre');
            return;
        }

        const promptData = {
            type: types.join(', '),
            vehicules: getCheckedValues('vehicule').join(', '),
            lieu: getCheckedValues('lieu').join(', '),
            nbSP: document.getElementById('nb-personnel').value,
            consignes: document.getElementById('consignes-particulieres').value
        };

        // UI Loading
        btn.disabled = true;
        btn.innerHTML = '<span>‚è≥</span> Analyse tactique en cours...';
        resultatDiv.style.display = 'none';

        try {
            // APPEL S√âCURIS√â VERS VERCEL API (Pas de cl√© ici !)
            const response = await fetch('/api/gemini', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: JSON.stringify(promptData) })
            });

            const data = await response.json();
            
            if (data.error) throw new Error(data.error);

            contenuDiv.innerHTML = formatScenario(data.text);
            resultatDiv.style.display = 'block';
            resultatDiv.scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            console.error('Erreur:', error);
            alert('‚ùå Erreur de connexion au serveur tactique. V√©rifiez votre d√©ploiement Vercel.');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<span>ü§ñ</span> G√âN√âRER LE SC√âNARIO';
        }
    }

    // Fonctions utilitaires (formatage, etc.)
    function getCheckedValues(name) {
        return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value);
    }

    function formatScenario(texte) {
        return texte.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
    }
    </script>

    <script src="js/app.js"></script>
</body>
</html>
