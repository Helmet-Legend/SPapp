<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="version" content="1.10">
    <meta name="author" content="RESCUEAPP - LP ACADEMY">
    <meta name="theme-color" content="#c41e3a">
    <title>DECIOPS v1.10</title>
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body class="theme-day">
    
    <!-- STRUCTURE HTML AJOUT√âE -->
    <header>
        <h1>üöí DECIOPS v1.10</h1>
        <p>G√©n√©rateur de sc√©narios tactiques</p>
    </header>

    <main class="container">
        <section class="form-section">
            <h2>Configuration du sc√©nario</h2>
            
            <div class="field-group">
                <label>Type de man≈ìuvre :</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="type" value="incendie"> Incendie</label>
                    <label><input type="checkbox" name="type" value="sauvetage"> Sauvetage</label>
                    <label><input type="checkbox" name="type" value="secours-routier"> Secours routier</label>
                    <label><input type="checkbox" name="type" value="risque-chimique"> Risque chimique</label>
                </div>
            </div>

            <div class="field-group">
                <label>V√©hicules disponibles :</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="vehicule" value="VSAV"> VSAV</label>
                    <label><input type="checkbox" name="vehicule" value="FPT"> FPT</label>
                    <label><input type="checkbox" name="vehicule" value="EPA"> EPA</label>
                    <label><input type="checkbox" name="vehicule" value="FMOGP"> FMOGP</label>
                </div>
            </div>

            <div class="field-group">
                <label>Lieu d'intervention :</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="lieu" value="habitation"> Habitation</label>
                    <label><input type="checkbox" name="lieu" value="erp"> ERP</label>
                    <label><input type="checkbox" name="lieu" value="voie-publique"> Voie publique</label>
                    <label><input type="checkbox" name="lieu" value="industriel"> Site industriel</label>
                </div>
            </div>

            <div class="field-group">
                <label for="nb-personnel">Nombre de personnel :</label>
                <input type="number" id="nb-personnel" min="1" max="50" value="10">
            </div>

            <div class="field-group">
                <label for="consignes-particulieres">Consignes particuli√®res :</label>
                <textarea id="consignes-particulieres" rows="4" placeholder="Ajoutez des contraintes ou objectifs sp√©cifiques..."></textarea>
            </div>

            <button id="btn-generer" onclick="genererManoeuvre()">
                <span>ü§ñ</span> G√âN√âRER LE SC√âNARIO
            </button>
        </section>

        <section id="resultat-ia" style="display: none;">
            <h2>üìã Sc√©nario g√©n√©r√©</h2>
            <div id="scenario-contenu" class="scenario-box"></div>
        </section>
    </main>

    <script>
    async function genererManoeuvre() {
        const btn = document.getElementById('btn-generer');
        const resultatDiv = document.getElementById('resultat-ia');
        const contenuDiv = document.getElementById('scenario-contenu');

        // Collecte des donn√©es
        const types = getCheckedValues('type');
        if (types.length === 0) {
            alert('‚ö†Ô∏è Veuillez s√©lectionner au moins un type de man≈ìuvre');
            return;
        }

        const promptData = {
            type: types.join(', '),
            vehicules: getCheckedValues('vehicule').join(', '),
            lieu: getCheckedValues('lieu').join(', '),
            nbSP: document.getElementById('nb-personnel').value,
            consignes: document.getElementById('consignes-particulieres').value
        };

        // UI Loading
        btn.disabled = true;
        btn.innerHTML = '<span>‚è≥</span> Analyse tactique en cours...';
        resultatDiv.style.display = 'none';

        try {
            // APPEL S√âCURIS√â VERS VERCEL API (Pas de cl√© ici !)
            const response = await fetch('/api/gemini', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: JSON.stringify(promptData) })
            });

            if (!response.ok) {
                throw new Error(`Erreur HTTP: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.error) throw new Error(data.error);

            contenuDiv.innerHTML = formatScenario(data.text);
            resultatDiv.style.display = 'block';
            resultatDiv.scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            console.error('Erreur:', error);
            alert('‚ùå Erreur de connexion au serveur tactique. V√©rifiez votre d√©ploiement Vercel.');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<span>ü§ñ</span> G√âN√âRER LE SC√âNARIO';
        }
    }

    // Fonctions utilitaires (formatage, etc.)
    function getCheckedValues(name) {
        return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value);
    }

    function formatScenario(texte) {
        return texte.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
    }
    </script>

    <script src="js/app.js"></script>
</body>
</html>
